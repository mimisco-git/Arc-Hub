<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arc Hub - Testnet Progress Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .logo {
            font-size: 48px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .input-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .credit {
            text-align: center;
            color: #999;
            font-size: 13px;
            margin-top: 10px;
        }

        .credit a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .credit a:hover {
            text-decoration: underline;
        }

        input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .activities-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-category {
            margin-bottom: 30px;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: 600;
            color: #667eea;
            font-size: 18px;
        }

        .activity-list {
            display: grid;
            gap: 15px;
        }

        .activity-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .activity-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .activity-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .activity-name {
            font-weight: 600;
            color: #333;
        }

        .activity-details {
            font-size: 12px;
            color: #666;
        }

        .activity-points {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #fee;
            border: 2px solid #fcc;
            border-radius: 12px;
            padding: 20px;
            color: #c33;
            margin-bottom: 20px;
        }

        .warning {
            background: #fff8e1;
            border: 2px solid #ffecb3;
            border-radius: 12px;
            padding: 15px;
            color: #f57c00;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .balance-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .balance-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .balance-amount {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .balance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .balance-item {
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }

        .balance-item-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .balance-item-value {
            font-size: 24px;
            font-weight: bold;
        }

        .tx-hash {
            font-family: monospace;
            font-size: 11px;
            color: #667eea;
            cursor: pointer;
        }

        .tx-hash:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .balance-amount {
                font-size: 36px;
            }
            .input-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üåê ARC HUB</div>
            <div class="subtitle">Testnet Progress Tracker</div>
        </div>

        <div class="input-section">
            <div class="input-group">
                <input type="text" id="walletInput" placeholder="Enter your wallet address (0x...)" />
                <button onclick="checkWallet()" id="checkBtn">üîç Check Statistics</button>
            </div>
            <div class="credit">Designed by <a href="https://twitter.com/sir_mimisco" target="_blank">@sir_mimisco</a></div>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const ARC_RPC = 'https://5042002.rpc.thirdweb.com';
        const BLOCKSCOUT_API = 'https://testnet.arcscan.app/api/v2';
        const EXPLORER_URL = 'https://testnet.arcscan.app';
        
        let walletData = {
            address: '',
            balance: 0,
            transactions: [],
            activities: {
                swaps: [],
                bridges: [],
                liquidity: [],
                nfts: [],
                other: []
            },
            totalPoints: 0
        };

        async function checkWallet() {
            const address = document.getElementById('walletInput').value.trim();
            
            if (!address || !address.startsWith('0x') || address.length !== 42) {
                alert('Please enter a valid wallet address starting with 0x (42 characters)');
                return;
            }

            walletData.address = address;
            document.getElementById('checkBtn').disabled = true;
            document.getElementById('checkBtn').textContent = '‚è≥ Loading...';
            document.getElementById('results').innerHTML = '<div class="loading">üîç Fetching your Arc testnet data...<br>This may take a few moments...</div>';

            try {
                await Promise.all([
                    fetchBalance(address),
                    fetchTransactions(address)
                ]);
                
                analyzeActivities();
                displayResults();
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        ‚ùå Error loading data: ${error.message}
                        <br><br>
                        <small>Troubleshooting tips:</small>
                        <ul style="margin: 10px 0 0 20px; text-align: left;">
                            <li>Make sure the wallet address is correct (42 characters starting with 0x)</li>
                            <li>Ensure the wallet has activity on Arc testnet</li>
                            <li>Try refreshing the page and trying again</li>
                            <li>Check the browser console (F12) for more details</li>
                        </ul>
                    </div>
                `;
            } finally {
                document.getElementById('checkBtn').disabled = false;
                document.getElementById('checkBtn').textContent = 'üîç Check Statistics';
            }
        }

        async function fetchBalance(address) {
            try {
                const response = await fetch(ARC_RPC, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        method: 'eth_getBalance',
                        params: [address, 'latest'],
                        id: 1
                    })
                });
                
                if (!response.ok) {
                    console.warn(`RPC request failed: ${response.status}`);
                    walletData.balance = 0;
                    return;
                }
                
                const data = await response.json();
                
                if (data.error) {
                    console.error('RPC Error:', data.error);
                    walletData.balance = 0;
                } else if (data.result) {
                    walletData.balance = parseInt(data.result, 16) / 1e18;
                }
            } catch (error) {
                console.error('Error fetching balance:', error);
                walletData.balance = 0;
            }
        }

        async function fetchTransactions(address) {
            try {
                const url = `${BLOCKSCOUT_API}/addresses/${address}/transactions`;
                console.log('Fetching from:', url);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`API request failed with status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                
                if (data && data.items && Array.isArray(data.items)) {
                    walletData.transactions = data.items;
                    console.log(`Found ${data.items.length} transactions`);
                } else if (data && Array.isArray(data)) {
                    walletData.transactions = data;
                    console.log(`Found ${data.length} transactions (array format)`);
                } else {
                    console.log('No transactions found or unexpected response format:', data);
                    walletData.transactions = [];
                }
            } catch (error) {
                console.error('Error fetching transactions:', error);
                walletData.transactions = [];
                throw error;
            }
        }

        function safeGet(obj, path, defaultValue = '') {
            return path.split('.').reduce((acc, part) => acc && acc[part], obj) || defaultValue;
        }

        function analyzeActivities() {
            walletData.activities = {
                swaps: [],
                bridges: [],
                liquidity: [],
                nfts: [],
                other: []
            };
            walletData.totalPoints = 0;

            walletData.transactions.forEach(tx => {
                try {
                    const method = safeGet(tx, 'method', '').toLowerCase();
                    const to = safeGet(tx, 'to.hash', safeGet(tx, 'to', '')).toLowerCase();
                    const from = safeGet(tx, 'from.hash', safeGet(tx, 'from', '')).toLowerCase();
                    const value = safeGet(tx, 'value', '0');
                    
                    let activity = {
                        hash: tx.hash || 'unknown',
                        timestamp: tx.timestamp ? new Date(tx.timestamp).toLocaleDateString() : 'N/A',
                        value: value ? (parseInt(value) / 1e18).toFixed(4) : '0',
                        method: method || tx.method || 'Transfer',
                        points: 0,
                        to: to,
                        from: from
                    };

                    if (method.includes('swap') || method.includes('exchange')) {
                        activity.type = 'Token Swap';
                        activity.points = 10;
                        walletData.activities.swaps.push(activity);
                    } else if (method.includes('bridge') || method.includes('deposit') || method.includes('withdraw')) {
                        activity.type = 'Bridge Transaction';
                        activity.points = 15;
                        walletData.activities.bridges.push(activity);
                    } else if (method.includes('addliquidity') || method.includes('removeliquidity') || method.includes('stake')) {
                        activity.type = 'Liquidity Pool';
                        activity.points = 20;
                        walletData.activities.liquidity.push(activity);
                    } else if (method.includes('mint') || method.includes('safemint')) {
                        activity.type = 'NFT/Token Mint';
                        activity.points = 5;
                        walletData.activities.nfts.push(activity);
                    } else if (value && parseInt(value) > 0) {
                        activity.type = 'Transfer';
                        activity.points = 2;
                        walletData.activities.other.push(activity);
                    } else {
                        activity.type = 'Contract Interaction';
                        activity.points = 3;
                        walletData.activities.other.push(activity);
                    }

                    walletData.totalPoints += activity.points;
                } catch (err) {
                    console.error('Error processing transaction:', tx, err);
                }
            });
        }

        function displayResults() {
            const totalTxs = walletData.transactions.length;
            const level = Math.floor(walletData.totalPoints / 100) + 1;
            
            let firstTxDate = null;
            if (totalTxs > 0) {
                const timestamps = walletData.transactions
                    .map(tx => tx.timestamp ? new Date(tx.timestamp) : null)
                    .filter(date => date && !isNaN(date));
                
                if (timestamps.length > 0) {
                    firstTxDate = new Date(Math.min(...timestamps));
                }
            }
            
            const daysActive = firstTxDate ? 
                Math.ceil((Date.now() - firstTxDate.getTime()) / (1000 * 60 * 60 * 24)) : 0;

            let html = '';

            if (totalTxs === 0) {
                html += `
                    <div class="warning">
                        ‚ö†Ô∏è No transactions found for this address on Arc testnet. 
                        <br><br>
                        <strong>Possible reasons:</strong>
                        <ul style="margin: 10px 0 0 20px;">
                            <li>The address is new and hasn't made any transactions yet</li>
                            <li>Transactions are still being indexed by the explorer</li>
                            <li>Double-check your wallet address is correct</li>
                        </ul>
                    </div>
                `;
            }

            html += `
                <div class="balance-card">
                    <div class="balance-title">üí∞ Your Arc Balance</div>
                    <div class="balance-amount">${walletData.balance.toFixed(4)} USDC</div>
                    <div class="balance-grid">
                        <div class="balance-item">
                            <div class="balance-item-label">Wallet Address</div>
                            <div class="balance-item-value" style="font-size: 12px; word-break: break-all;">
                                ${walletData.address.substring(0, 10)}...${walletData.address.substring(32)}
                            </div>
                        </div>
                        <div class="balance-item">
                            <div class="balance-item-label">Total Points</div>
                            <div class="balance-item-value">${walletData.totalPoints}</div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalTxs}</div>
                        <div class="stat-label">Total Transactions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${level}</div>
                        <div class="stat-label">Current Level</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${walletData.totalPoints}</div>
                        <div class="stat-label">Total Points</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${daysActive}</div>
                        <div class="stat-label">Days Active</div>
                    </div>
                </div>
            `;

            if (totalTxs > 0) {
                html += `
                    <div class="activities-section">
                        <div class="section-title">üìä Your On-Chain Activities</div>
                `;

                const categories = [
                    { name: 'üí± Token Swaps', data: walletData.activities.swaps, icon: 'üí±' },
                    { name: 'üåâ Bridge Transactions', data: walletData.activities.bridges, icon: 'üåâ' },
                    { name: 'üíß Liquidity Pools', data: walletData.activities.liquidity, icon: 'üíß' },
                    { name: 'üé® NFT & Minting', data: walletData.activities.nfts, icon: 'üé®' },
                    { name: 'üìù Other Activities', data: walletData.activities.other, icon: 'üìù' }
                ];

                categories.forEach(cat => {
                    if (cat.data.length > 0) {
                        html += `
                            <div class="activity-category">
                                <div class="category-header">${cat.name} (${cat.data.length})</div>
                                <div class="activity-list">
                        `;

                        cat.data.forEach(activity => {
                            html += `
                                <div class="activity-item">
                                    <div class="activity-info">
                                        <div class="activity-name">${activity.type} - ${activity.method}</div>
                                        <div class="activity-details">
                                            ${activity.timestamp} ‚Ä¢ Value: ${activity.value} USDC
                                            <br><span class="tx-hash" onclick="window.open('${EXPLORER_URL}/tx/${activity.hash}', '_blank')">${activity.hash.substring(0, 20)}...</span>
                                        </div>
                                    </div>
                                    <div class="activity-points">+${activity.points} pts</div>
                                </div>
                            `;
                        });

                        html += `
                                </div>
                            </div>
                        `;
                    }
                });

                html += '</div>';
            }

            document.getElementById('results').innerHTML = html;
        }

        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const address = urlParams.get('address');
            if (address) {
                document.getElementById('walletInput').value = address;
                checkWallet();
            }
        });
    </script>
</body>
</html>
